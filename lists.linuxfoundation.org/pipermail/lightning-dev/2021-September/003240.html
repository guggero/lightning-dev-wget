<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Stateless invoices with proof-of-payment
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2021-September/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Stateless%20invoices%20with%20proof-of-payment&In-Reply-To=%3C3DoKw_u9SuDaJrVcUUwfrbrJrR7juGBVJMkS-4s28kb7seZiiAKR5BVGHa62JNgi9edKlt9np9pnbSLWSZ82tv4tYvj83dRBBlGH5U--Ch4%3D%40protonmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003238.html">
   <LINK REL="Next"  HREF="003239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Stateless invoices with proof-of-payment</H1>
    <B>ZmnSCPxj</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Stateless%20invoices%20with%20proof-of-payment&In-Reply-To=%3C3DoKw_u9SuDaJrVcUUwfrbrJrR7juGBVJMkS-4s28kb7seZiiAKR5BVGHa62JNgi9edKlt9np9pnbSLWSZ82tv4tYvj83dRBBlGH5U--Ch4%3D%40protonmail.com%3E"
       TITLE="[Lightning-dev] Stateless invoices with proof-of-payment">ZmnSCPxj at protonmail.com
       </A><BR>
    <I>Tue Sep 21 11:44:16 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="003238.html">[Lightning-dev] Stateless invoices with proof-of-payment
</A></li>
        <LI>Next message: <A HREF="003239.html">[Lightning-dev] Stateless invoices with proof-of-payment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3240">[ date ]</a>
              <a href="thread.html#3240">[ thread ]</a>
              <a href="subject.html#3240">[ subject ]</a>
              <a href="author.html#3240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning Joost,

&gt;<i> &gt; &gt; preimage = H(node_secret | payment_secret | payment_amount | encoded_order_details)
</I>&gt;<i> &gt; &gt; invoice_hash = H(preimage)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The sender sends an htlc locked to invoice_hash for payment_amount and passes along payment_secret and encoded_order_details in a custom tlv record.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; When the recipient receives the htlc, they reconstruct the preimage according to the formula above. At this point, all data is available to do so. When H(preimage) indeed matches the htlc hash, they can settle the payment knowing that this is an order that they committed to earlier. Settling could be implemented as a just-in-time inserted invoice to keep the diff small.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The preimage is returned to the sender and serves as a proof of payment.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Does this actually work?
</I>&gt;<i> &gt; How does the sender know the `invoice_hash` to lock the HTLC(s) to?
</I>&gt;<i>
</I>&gt;<i> &gt; If the sender does not know the `node_secret` (from its name, I am guessing it is a secret known only by the recipient?) then it cannot compute `invoice_hash`, the `invoice_hash` has to be somehow learned by the sender from the recipient.
</I>&gt;<i>
</I>&gt;<i> So to be clear: this isn't a spontaneous payment protocol with proof-of-payment. The sender will still request an invoice from the recipient via an ordinary http request (think of a paywall with qr invoice that is presented when web-browsing to a paid article). That is also how the sender learns the invoice_hash. It is part of the bolt11 payment request as it always is.
</I>&gt;<i>
</I>&gt;<i> The goal of the scheme is to alleviate the recipient from storing the invoices that they generate.
</I>
Ah, thanks for the clarification.
This should probably work, then.

Regards,
ZmnSCPxj
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003238.html">[Lightning-dev] Stateless invoices with proof-of-payment
</A></li>
	<LI>Next message: <A HREF="003239.html">[Lightning-dev] Stateless invoices with proof-of-payment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3240">[ date ]</a>
              <a href="thread.html#3240">[ thread ]</a>
              <a href="subject.html#3240">[ subject ]</a>
              <a href="author.html#3240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
