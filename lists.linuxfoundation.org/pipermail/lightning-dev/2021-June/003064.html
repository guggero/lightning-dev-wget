<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Waiting SIGHASH_ANYPREVOUT and Packing Packages
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2021-June/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Waiting%20SIGHASH_ANYPREVOUT%20and%20Packing%20Packages&In-Reply-To=%3CCALZpt%2BHxunWGLHJuHwnY0i%3DTD9if3OT9S%2BvPdXwPFHy403LjUQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003062.html">
   <LINK REL="Next"  HREF="003063.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Waiting SIGHASH_ANYPREVOUT and Packing Packages</H1>
    <B>Antoine Riard</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Waiting%20SIGHASH_ANYPREVOUT%20and%20Packing%20Packages&In-Reply-To=%3CCALZpt%2BHxunWGLHJuHwnY0i%3DTD9if3OT9S%2BvPdXwPFHy403LjUQ%40mail.gmail.com%3E"
       TITLE="[Lightning-dev] Waiting SIGHASH_ANYPREVOUT and Packing Packages">antoine.riard at gmail.com
       </A><BR>
    <I>Thu Jun 24 13:03:21 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="003062.html">[Lightning-dev] Waiting SIGHASH_ANYPREVOUT and Packing Packages
</A></li>
        <LI>Next message: <A HREF="003063.html">[Lightning-dev] On the recent softforks survey,	forget to fulfill my answer!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3064">[ date ]</a>
              <a href="thread.html#3064">[ thread ]</a>
              <a href="subject.html#3064">[ subject ]</a>
              <a href="author.html#3064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

&gt;<i> Browsing quickly through Greg's piece, a lot of the reasoning is based on
</I>FOSS experience from Linux/Juniper, which to the best of my knowledge are
centralized software projects ?

&gt;<i> That is Greg's point. If Linux doesn't look further than the current
</I>&gt;<i> version and the next version with a BDFL (Linus) a decentralized
</I>&gt;<i> project like Bitcoin Core is going to struggle even more with longer
</I>&gt;<i> term roadmaps.
</I>
I was far more inclined to recall the unsolved problems for Lightning/L2s
(pre-signed feerate/tx-pinnings) than calling out strong solutions to them.
I believe problem spaces are quite something stable in engineering/science,
at least until they're formalized differently. But even coming to consensus
on  the existence of problems and a shared perception of the severity of
them can take a long time. In fact, it might even be the hardest step in a
decentralized ecosystem like Bitcoin.

And I fill in on the low-relevance of roadmaps, real development is a
continuous zigzag. If we look in the past and take the transaction
malleability issue, I think we can observe it took multiple proposals (bip
62, normalized txid,  sighash_noinput, ...),  of which we're even
implemented in Core, before to finally settle on segwit. Though I would say
lessons were drawn about shortcomings of every transient proposal.

&gt;<i> I think it is important to discuss what order changes should be
</I>&gt;<i> attempted but I agree with David that putting specific future version
</I>&gt;<i> numbers on changes is speculative at best and misleading at worst. The
</I>&gt;<i> record of previous predictions of what will be included in particular
</I>&gt;<i> future versions is not strong :)
</I>
I recognize it wasn't delicate to put exact version numbers, though note
multiple, alternative versions numbers were deliberately proposed for each
specific change and timelines given in terms of years,  more as an invite
to open a discussion on such changes and where/when they could take place,
that in anyway a finite, consistent deployment proposal.

Further, I still believe it would be cool to have a bit more coordination
when Core implements sophisticated mechanisms designed for downstream
support, in the sense of feedback exchanged across projects all along their
release schedules. For e.g, with package-relay, as a Lightning team it's
likely you will have to rework your tx-broadcast module which might take a
few good weeks of review and test. Though, coming to this best practice
(imho) across the different Bitcoin layers might take years and that's
perfectly fine, we'll see what emerges :)

&gt;<i> What was making sense when you had like ~20 Bitcoin dev with 90% of the
</I>technical knowledge doesn't scale when you have multiple second-layers
specifications

&gt;<i> It is great that we have a larger set of contributors in the ecosystem
</I>&gt;<i> today than back in say pre 2017. But today that set of contributors is
</I>&gt;<i> spread widely across a number of different projects that didn't exist
</I>&gt;<i> pre 2017. Changes to Core are (generally) likely to be implemented and
</I>&gt;<i> reviewed by current Core contributors as Lightning implementation
</I>&gt;<i> developers (generally) seem to have their hands full with their own
</I>&gt;<i> implementations.
</I>
Well I strongly believe that the Core review process is open to anyone :) ?
If some upper layers contributors are generously offering their time to
share back their experiences, especially during the design phase of
software features, I hope we might be on path to deliver better stuff.

Further, that's a more personal note, I'm worried long-term about
layer-monoculture cropping up in the ecosystem, a concern echoing the
history of Internet development [0].

&gt;<i> I think we can get the balance right by making progress on this
</I>&gt;<i> (important) discussion whilst also maintaining humility that we don't
</I>&gt;<i> know exact timelines and that getting things merged into Core relies
</I>&gt;<i> on a number of people who have varying levels of interest and
</I>&gt;<i> understanding of L2 protocols.
</I>
Yes, as answers to my post are showing, I might have lacked patience in
this case :/ Sometimes, it's hard to gauge your own cognitive dissonance on
topics.

Cheers,
Antoine

[0] See &quot;Interactions between Layers&quot; in &quot;General Architectural and Policy
Considerations&quot;, RFC 3426

Le lun. 21 juin 2021 &#224; 06:20, Michael Folkson &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">michaelfolkson at gmail.com</A>&gt; a
&#233;crit :

&gt;<i> I don't want to divert from the topic of this thread (&quot;Waiting
</I>&gt;<i> SIGHASH_ANYPREVOUT and Packing Packages&quot;), we can set up a separate
</I>&gt;<i> thread if we want to discuss this further. But just a couple of
</I>&gt;<i> things.
</I>&gt;<i>
</I>&gt;<i> &gt; Browsing quickly through Greg's piece, a lot of the reasoning is based
</I>&gt;<i> on FOSS experience from Linux/Juniper, which to the best of my knowledge
</I>&gt;<i> are centralized software projects ?
</I>&gt;<i>
</I>&gt;<i> That is Greg's point. If Linux doesn't look further than the current
</I>&gt;<i> version and the next version with a BDFL (Linus) a decentralized
</I>&gt;<i> project like Bitcoin Core is going to struggle even more with longer
</I>&gt;<i> term roadmaps.
</I>&gt;<i>
</I>&gt;<i> I think it is important to discuss what order changes should be
</I>&gt;<i> attempted but I agree with David that putting specific future version
</I>&gt;<i> numbers on changes is speculative at best and misleading at worst. The
</I>&gt;<i> record of previous predictions of what will be included in particular
</I>&gt;<i> future versions is not strong :)
</I>&gt;<i>
</I>&gt;<i> &gt; What was making sense when you had like ~20 Bitcoin dev with 90% of the
</I>&gt;<i> technical knowledge doesn't scale when you have multiple second-layers
</I>&gt;<i> specifications
</I>&gt;<i>
</I>&gt;<i> It is great that we have a larger set of contributors in the ecosystem
</I>&gt;<i> today than back in say pre 2017. But today that set of contributors is
</I>&gt;<i> spread widely across a number of different projects that didn't exist
</I>&gt;<i> pre 2017. Changes to Core are (generally) likely to be implemented and
</I>&gt;<i> reviewed by current Core contributors as Lightning implementation
</I>&gt;<i> developers (generally) seem to have their hands full with their own
</I>&gt;<i> implementations.
</I>&gt;<i>
</I>&gt;<i> I think we can get the balance right by making progress on this
</I>&gt;<i> (important) discussion whilst also maintaining humility that we don't
</I>&gt;<i> know exact timelines and that getting things merged into Core relies
</I>&gt;<i> on a number of people who have varying levels of interest and
</I>&gt;<i> understanding of L2 protocols.
</I>&gt;<i>
</I>&gt;<i> On Mon, Jun 21, 2021 at 9:13 AM Antoine Riard &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">antoine.riard at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi Dave,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; That might work for current LN-penalty, but I'm not sure it works for
</I>&gt;<i> &gt; eltoo.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Well, we have not settled yet on the eltoo design but if we take the
</I>&gt;<i> later proposal in date [0], signing the update transaction with
</I>&gt;<i> SIGHGASH_ANYPREVOUT lets you attach non-interactively a single-party
</I>&gt;<i> controlled input at broadcast-time. Providing the input amount is high
</I>&gt;<i> enough to bump the transaction feerate over network mempools, it should
</I>&gt;<i> allow the tx to propagate across network mempools and that way solve the
</I>&gt;<i> pre-signed feerate problem as defined in the post ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt;  If Bitcoin Core can rewrite the blind CPFP fee bump transaction
</I>&gt;<i> &gt; &gt; to refer to any prevout, that implies anyone else can do the same.
</I>&gt;<i> &gt; &gt; Miners who were aware of two or more states from an eltoo channel would
</I>&gt;<i> &gt; &gt; be incentivized to rewrite to the oldest state, giving them fee revenue
</I>&gt;<i> &gt; &gt; now and ensuring fee revenue in the future when a later state update is
</I>&gt;<i> &gt; &gt; broadcast.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yep, you can add a per-participant key to lockdown the transaction and
</I>&gt;<i> avoid any in-flight malleability ? I think this is discussed in the &quot;A
</I>&gt;<i> Stroll through Fee-Bumping Techniques&quot; thread.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; If the attacker using pinning is able to reuse their attack at no cost,
</I>&gt;<i> &gt; &gt; they can re-pin the channel again and force the honest user to pay
</I>&gt;<i> &gt; &gt; another anyprevout bounty to miners.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is also true with package-relay where your counterparty, with a
</I>&gt;<i> better knowledge of network mempools, can always re-broadcast a CPFP-bumped
</I>&gt;<i> malicious package ? Under this assumption, I think you should always be
</I>&gt;<i> ready to bump our honest package.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Further, for the clarity of the discussion, can you point to which
</I>&gt;<i> pinning scenario you're thinking of or if it's new under
</I>&gt;<i> SIGHASH_ANYPREVOUT, describe it ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Repeat this a bunch of times and the honest user has now spent more on
</I>&gt;<i> fees than their balance from the
</I>&gt;<i> &gt; closed channel.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And sadly, as this concern also exists in case of a miner-harvesting
</I>&gt;<i> attack against LN nodes, a concern that Gleb and I expressed more than a
</I>&gt;<i> year ago in a public post [1], a good L2 client should always upper bound
</I>&gt;<i> its fee-bumping reserve. I've a short though-unclear note on this notion of
</I>&gt;<i> fee-bumping upper to warn other L2 engineers  in &quot;On Mempool Funny Games
</I>&gt;<i> against Multi-Party Funded Transactions&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please read so:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &quot;A L2 client, with only a view of its mempool at best, won't understand
</I>&gt;<i> why
</I>&gt;<i> &gt;  the transaction doesn't confirm and if it's responsible for the
</I>&gt;<i> &gt;  fee-bumping, it might do multiple rounds of feerate increase through
</I>&gt;<i> CPFP,
</I>&gt;<i> &gt;  in vain. As the fee-bumping algorithm is assumed to be known if the
</I>&gt;<i> victim
</I>&gt;<i> &gt;  client is open source code, the attacker can predict when the
</I>&gt;<i> fee-bumping
</I>&gt;<i> &gt;  logic reaches its upper bound.&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Though thanks for the recall! I should log dynamic-balances in RL's
</I>&gt;<i> `ChannelMonitorUpdate` for our ongoing implementation of anchor, updating
</I>&gt;<i> my TODO :p
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Even if my analysis above is wrong, I would encourage you or Matt or
</I>&gt;<i> &gt; someone to write up this anyprevout idea in more detail and distribute
</I>&gt;<i> &gt; it before you promote it much more.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's a really fair point, as a lot of the reasoning was based on
</I>&gt;<i> private discussion with Matt. Though as SIGHASH_ANYPREVOUT isn't advocated
</I>&gt;<i> for community consensus and those things take time, should just take a few
</I>&gt;<i> hours of my time.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Even if every protocol based on presigned transactions can magically
</I>&gt;<i> &gt; allow dynamically adding inputs and modifying outputs for fees, and we
</I>&gt;<i> &gt; also have a magic perfect transaction replacement protocol,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &quot;&#8220;Any sufficiently advanced technology is indistinguishable from magic.&#8221;
</I>&gt;<i> Arthur C. Clarke
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Wit apart, that might be the outcome with careful bitcoin protocol
</I>&gt;<i> development, where technical issues are laid out in a best effort (of
</I>&gt;<i> mine!) and spread to the Bitcoin community on the most public bitcoin
</I>&gt;<i> communication channel ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And humbly, on all those L2 issues I did change my opinion, as I've
</I>&gt;<i> written so much explicitly in this thread post by pointing to an older post
</I>&gt;<i> of mine (&quot;Advances in Bitcoin Contracting : Uniform Policy and Package
</I>&gt;<i> Relay&quot;). This reversal, partially motivated by a lot of discussion with
</I>&gt;<i> folks, including yourself, initiated since at least mid last year.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; package relay is still fundamentally useful for CPFP fee bumping very
</I>&gt;<i> low
</I>&gt;<i> &gt; &gt; feerate transactions received from an external party.  E.g. Alice pays
</I>&gt;<i> &gt; &gt; Bob, mempool min feerates increase and Alice's transaction is dropped,
</I>&gt;<i> &gt; &gt; Bob still wants the money, so he submits a package with Alice's
</I>&gt;<i> &gt; &gt; transaction plus his own high feerate spend of it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think this point would be a reverse of our p2p design where we are now
</I>&gt;<i> making the sender responsible for the receiver quality of its mempool
</I>&gt;<i> feerate ? This question has never been clear up during the years-long
</I>&gt;<i> discussion of package-relay design [1].
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Though referring to the thread post and last week's transaction-relay
</I>&gt;<i> workshop, I did point out that package-relay might serve in the long-term
</I>&gt;<i> as a mempool-sync mechanism to prevent potential malicious mempool
</I>&gt;<i> partitions [2].
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Package relay is a clear improvement now, and one I expect to be
</I>&gt;<i> &gt; permanent for as long as we're using anything like the current protocol
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Again, reading my post, I did point out that we might keep the &quot;lower
</I>&gt;<i> half&quot; of package-relay and deprecate only the higher part of it as we have
</I>&gt;<i> more feerate-efficient fee-bumping primitive available. If  it sounds too
</I>&gt;<i> much of a release engineering effort to synchronize on the scale of an
</I>&gt;<i> ecosystem, think about the ongoing deprecation of Tor V2.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Further, you did express a far less assertive opinion during last
</I>&gt;<i> Tuesday transaction-relay workshops, to which a lot of folks attended,
</I>&gt;<i> where you pointed it might not be a good idea for L2s to make more
</I>&gt;<i> assumptions on non-normative:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &quot;harding&gt; I do think we should be using miners profit incentive more for
</I>&gt;<i> stuff rather than trying to normalize mempool policy (which not entirely
</I>&gt;<i> possible), e.g. things like
</I>&gt;<i> <A HREF="../2020-April/002664.html">https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-April/002664.html</A>
</I>&gt;<i> &quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Arguing for package-relay &quot;permanence&quot; moves in the contrary decision
</I>&gt;<i> IMHO ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I don't think it's appropriate to be creating timelines like this that
</I>&gt;<i> &gt; depend on the work of a large number of contributors who I don't believe
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks Dave, this is your opinion and I respect this. I'll let any
</I>&gt;<i> participant of this mailing list make an opinion on its own, following
</I>&gt;<i> their private judgement. It might be based from a lot of different factors,
</I>&gt;<i> e.g &quot;trusting the experts&quot; or gathering diverse in-field authorities'
</I>&gt;<i> opinions or reasoning from scratch based on raw, public facts.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Though might I ask you on which information sources are you finding your
</I>&gt;<i> belief ? I'm curious if you're aware of any contributors who feel entitled
</I>&gt;<i> to be consulted in a decentralized development process...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For the records, I did consult no one. As even in the technical circle
</I>&gt;<i> that would have been a lot of open source projects teams to reach out :
</I>&gt;<i> LND, c-ligtning, Eclair, coin-teleport, revault, sapio, btcsuite, bcoin,
</I>&gt;<i> libbitcoin, wasabi's coinjoin, samourai wallet's coinjoin, ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I was lazy, I just shot a mail :p
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; W.r.t to Greg's 4-year old's piece, I'll let him express his opinion on
</I>&gt;<i> how the expressed framework applies to my post, the Bitcoin dev stage has
</I>&gt;<i> grown a lot since then. What was making sense when you had like ~20 Bitcoin
</I>&gt;<i> dev with 90% of the technical knowledge doesn't scale when you have
</I>&gt;<i> multiple second-layers specifications of which you have multiple
</I>&gt;<i> implementations teams, some of them  decentralized and spread through
</I>&gt;<i> different countries/timezones, IMHO.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Though, Dave if you strongly hold your opinion on my behavior, I would
</I>&gt;<i> invite you to do this intellectual work by yourself.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Browsing quickly through Greg's piece, a lot of the reasoning is based
</I>&gt;<i> on FOSS experience from Linux/Juniper, which to the best of my knowledge
</I>&gt;<i> are centralized software projects ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Note, also Paul Storzc's post has the simple phrase :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &quot;I emphasized concrete numbers, and concrete dates&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I believe my post doesn't have such numbers and concrete dates ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Presence of Core version numbers are motivated as clear signalling for
</I>&gt;<i> L2 developpers to update their backend in case of undocumented, subtle
</I>&gt;<i> policy changes slipping in the codebase. Let's minimize CVE-2020-26895
</I>&gt;<i> style-of-bugs across the ecosystem :/
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Finally, the presence of timelines in this post is also a gentle call
</I>&gt;<i> for the Bitcoin ecosystem to act on those safety holes, of which the
</I>&gt;<i> seriousness has been underscored by a lot of contributors in the past,
</I>&gt;<i> especially for the pre-signed feerate problem and even before I was in the
</I>&gt;<i> Bitcoin stage.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So better to patch them before they do manifest in the wild, and folks
</I>&gt;<i> start to bleed coins.  What you learn from practicing security research,
</I>&gt;<i> the lack of action can be harmful :/
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Stuff will get done when it gets done.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Don't forget bugs might slip in but that's fine if you have the skilled
</I>&gt;<i> folks around to catch them :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And yes I really care about Lightning, and all those cute new L2
</I>&gt;<i> protocols fostering in the community :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Finally, you know Dave, I'm just spreading ideas.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If those ideas are sound and folks love them, awesome! They're free to
</I>&gt;<i> use, study, share and modify them to build better systems.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If I'm wrong, like I've been in the past, like I might be today and like
</I>&gt;<i> I'll be in the future, I hope they will be patient to teach me back and
</I>&gt;<i> we'll learn.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hacker ethos :) ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; Antoine
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [0]
</I>&gt;<i> <A HREF="../2020-January/002448.html">https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-January/002448.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [1] <A HREF="https://github.com/bitcoin/bitcoin/issues/14895">https://github.com/bitcoin/bitcoin/issues/14895</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [2]
</I>&gt;<i> <A HREF="../2020-February/002569.html">https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-February/002569.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Le sam. 19 juin 2021 &#224; 09:38, David A. Harding &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">dave at dtrt.org</A>&gt; a &#233;crit :
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Fri, Jun 18, 2021 at 06:11:38PM -0400, Antoine Riard wrote:
</I>&gt;<i> &gt;&gt; &gt; 2) Solving the Pre-Signed Feerate problem : Package-Relay or
</I>&gt;<i> &gt;&gt; &gt; SIGHASH_ANYPREVOUT
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; For Lightning, either package-relay or SIGHASH_ANYPREVOUT should be
</I>&gt;<i> able to
</I>&gt;<i> &gt;&gt; &gt; solve the pre-signed feerate issue [3]
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; [...]
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; [3] I don't think there is a clear discussion on how
</I>&gt;<i> SIGHASH_ANYPREVOUT
</I>&gt;<i> &gt;&gt; &gt; solves pinnings beyond those LN meetings logs:
</I>&gt;<i> &gt;&gt; &gt; <A HREF="https://gnusha.org/lightning-dev/2020-06-08.log">https://gnusha.org/lightning-dev/2020-06-08.log</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; For anyone else looking, the most relevant line seems to be:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;   13:50 &lt; BlueMatt&gt; (sidenote: sighash_no_input is *really* elegant here
</I>&gt;<i> &gt;&gt;   - assuming a lot of complicated logic in core to do so, you could
</I>&gt;<i> &gt;&gt;   imagine blind-cpfp-bumping *any* commitment tx without knowing its
</I>&gt;<i> &gt;&gt;   there or which one it is all with one tx.......in theory)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; That might work for current LN-penalty, but I'm not sure it works for
</I>&gt;<i> &gt;&gt; eltoo.  If Bitcoin Core can rewrite the blind CPFP fee bump transaction
</I>&gt;<i> &gt;&gt; to refer to any prevout, that implies anyone else can do the same.
</I>&gt;<i> &gt;&gt; Miners who were aware of two or more states from an eltoo channel would
</I>&gt;<i> &gt;&gt; be incentivized to rewrite to the oldest state, giving them fee revenue
</I>&gt;<i> &gt;&gt; now and ensuring fee revenue in the future when a later state update is
</I>&gt;<i> &gt;&gt; broadcast.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If the attacker using pinning is able to reuse their attack at no cost,
</I>&gt;<i> &gt;&gt; they can re-pin the channel again and force the honest user to pay
</I>&gt;<i> &gt;&gt; another anyprevout bounty to miners.  Repeat this a bunch of times and
</I>&gt;<i> &gt;&gt; the honest user has now spent more on fees than their balance from the
</I>&gt;<i> &gt;&gt; closed channel.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Even if my analysis above is wrong, I would encourage you or Matt or
</I>&gt;<i> &gt;&gt; someone to write up this anyprevout idea in more detail and distribute
</I>&gt;<i> &gt;&gt; it before you promote it much more.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; package-relay sounds a reasonable, temporary &quot;patch&quot;.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Even if every protocol based on presigned transactions can magically
</I>&gt;<i> &gt;&gt; allow dynamically adding inputs and modifying outputs for fees, and we
</I>&gt;<i> &gt;&gt; also have a magic perfect transaction replacement protocol, package
</I>&gt;<i> &gt;&gt; relay is still fundamentally useful for CPFP fee bumping very low
</I>&gt;<i> &gt;&gt; feerate transactions received from an external party.  E.g. Alice pays
</I>&gt;<i> &gt;&gt; Bob, mempool min feerates increase and Alice's transaction is dropped,
</I>&gt;<i> &gt;&gt; Bob still wants the money, so he submits a package with Alice's
</I>&gt;<i> &gt;&gt; transaction plus his own high feerate spend of it.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Package relay is a clear improvement now, and one I expect to be
</I>&gt;<i> &gt;&gt; permanent for as long as we're using anything like the current protocol.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; # Deployment timeline
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; So what I believe as a rough deployment timeline.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I don't think it's appropriate to be creating timelines like this that
</I>&gt;<i> &gt;&gt; depend on the work of a large number of contributors who I don't believe
</I>&gt;<i> &gt;&gt; you've consulted.  For details on this point of view, please see
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> <A HREF="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-July/014726.html">https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-July/014726.html</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Stuff will get done when it gets done.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -Dave
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Lightning-dev mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">Lightning-dev at lists.linuxfoundation.org</A>
</I>&gt;<i> &gt; <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Michael Folkson
</I>&gt;<i> Email: <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">michaelfolkson at gmail.com</A>
</I>&gt;<i> Keybase: michaelfolkson
</I>&gt;<i> PGP: 43ED C999 9F85 1D40 EAF4 9835 92D6 0159 214C FEE3
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20210624/9995e15b/attachment-0001.html">http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20210624/9995e15b/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003062.html">[Lightning-dev] Waiting SIGHASH_ANYPREVOUT and Packing Packages
</A></li>
	<LI>Next message: <A HREF="003063.html">[Lightning-dev] On the recent softforks survey,	forget to fulfill my answer!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3064">[ date ]</a>
              <a href="thread.html#3064">[ thread ]</a>
              <a href="subject.html#3064">[ subject ]</a>
              <a href="author.html#3064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
