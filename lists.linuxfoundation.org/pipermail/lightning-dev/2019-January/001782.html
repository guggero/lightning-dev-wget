<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Reuse of payment_hash in lightning invoices
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-January/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Reuse%20of%20payment_hash%20in%20lightning%20invoices&In-Reply-To=%3Ct-p6L81LqsSH7d9NCv3D7wrw4XKtFmWWMKmgFX045qoQ65f8obmz-8bI5oayze81ldZJSVMgWXNUyze48Y7-LpiTZMWI_EYK9L-83JhKkPg%3D%40protonmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001780.html">
   <LINK REL="Next"  HREF="001786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Reuse of payment_hash in lightning invoices</H1>
    <B>ZmnSCPxj</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Reuse%20of%20payment_hash%20in%20lightning%20invoices&In-Reply-To=%3Ct-p6L81LqsSH7d9NCv3D7wrw4XKtFmWWMKmgFX045qoQ65f8obmz-8bI5oayze81ldZJSVMgWXNUyze48Y7-LpiTZMWI_EYK9L-83JhKkPg%3D%40protonmail.com%3E"
       TITLE="[Lightning-dev] Reuse of payment_hash in lightning invoices">ZmnSCPxj at protonmail.com
       </A><BR>
    <I>Thu Jan  3 13:13:47 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="001780.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
        <LI>Next message: <A HREF="001786.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1782">[ date ]</a>
              <a href="thread.html#1782">[ thread ]</a>
              <a href="subject.html#1782">[ subject ]</a>
              <a href="author.html#1782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning Andrea,

&gt;<i> For example a malicious receiver can provide an invoice with assisted routes where among those he/she controls a node and that node won't forward to the htlc but steal the funds instead (the preimage is known to the intermediate node as well), thus it will be claimed that the payment hasn't been received. If the above is correct then there should be at least a warning in the spec regarding the reuse of payment_hash in invoices.
</I>
The fact that ultimate payer has received the payment preimage is considered sufficient proof of payment.
Thus, in case of reuse, the fact that the ultimate payer has received the payment preimage is sufficient proof of payment, and whatever the receiver claims is to be ignored: the payment preimage in possession of the ultimate payee is considered the whole of the proof of payment.


&gt;<i>a malicious receiver can provide an invoice with assisted routes where among those he/she controls a node and that node won't forward to the htlc but steal the funds instead
</I>
Then the receiver has received it, not on the purported final node, but on another node it controls, and the fact that the ultimate payer has received the payment preimage is sufficient proof of that.

Obviously, if the receiver knows it does not control the entire Lightning Network, it should not reuse payment hashes, since intermediate nodes it does not control could claim the payment and give the proof-of-payment to the ultimate payer.
This can be clarified, but in the context of proofs, the attack you described is not possible, since the possession of the payment preimage is itself the entirety of the proof of the payment, regardless of what the receiver claims.

Regards,
ZmnSCPxj
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001780.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
	<LI>Next message: <A HREF="001786.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1782">[ date ]</a>
              <a href="thread.html#1782">[ thread ]</a>
              <a href="subject.html#1782">[ subject ]</a>
              <a href="author.html#1782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
