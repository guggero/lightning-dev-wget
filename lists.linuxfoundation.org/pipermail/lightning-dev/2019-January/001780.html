<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Reuse of payment_hash in lightning invoices
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-January/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Reuse%20of%20payment_hash%20in%20lightning%20invoices&In-Reply-To=%3CCAFQp%2BC34pPWbv4gtzuz4WQAH1isYVQPxZ%3D%2BWvsA4Xjrrdeb41g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001788.html">
   <LINK REL="Next"  HREF="001782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Reuse of payment_hash in lightning invoices</H1>
    <B>Andrea RASPITZU</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Reuse%20of%20payment_hash%20in%20lightning%20invoices&In-Reply-To=%3CCAFQp%2BC34pPWbv4gtzuz4WQAH1isYVQPxZ%3D%2BWvsA4Xjrrdeb41g%40mail.gmail.com%3E"
       TITLE="[Lightning-dev] Reuse of payment_hash in lightning invoices">andrea.raspitzu at acinq.fr
       </A><BR>
    <I>Thu Jan  3 12:40:16 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="001788.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
        <LI>Next message: <A HREF="001782.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1780">[ date ]</a>
              <a href="thread.html#1780">[ thread ]</a>
              <a href="subject.html#1780">[ subject ]</a>
              <a href="author.html#1780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning list,

I wanted to know your thoughts about the reuse of payment_hash in lightning
invoices, currently BOLT11 uses as example a donation invoice which seems
to be &quot;permanent&quot; i.e the payment_hash isn't changing after having received
a donation.I believe the reuse of known payment_hash is a security issue
because an intermediary node routing a donation for the second time already
knows the preimage, thus it can decide to pull the htlc from downstream
without actually forwarding it to upstream (can respond with a
htlc_fulfill). For example a malicious receiver can provide an invoice with
assisted routes where among those he/she controls a node and that node
won't forward to the htlc but steal the funds instead (the preimage is
known to the intermediate node as well), thus it will be claimed that the
payment hasn't been received. If the above is correct then there should be
at least a warning in the spec regarding the reuse of payment_hash in
invoices.

Cheers, Andrea.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20190103/34c9d848/attachment.html">http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20190103/34c9d848/attachment.html</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001788.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
	<LI>Next message: <A HREF="001782.html">[Lightning-dev] Reuse of payment_hash in lightning invoices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1780">[ date ]</a>
              <a href="thread.html#1780">[ thread ]</a>
              <a href="subject.html#1780">[ subject ]</a>
              <a href="author.html#1780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
