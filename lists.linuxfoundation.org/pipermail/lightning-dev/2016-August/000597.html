<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] [BOLT Draft] Onion Routing Spec
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2016-August/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20%5BBOLT%20Draft%5D%20Onion%20Routing%20Spec&In-Reply-To=%3C20160819183647.GB15105%40lightning.network%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000595.html">
   <LINK REL="Next"  HREF="000598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] [BOLT Draft] Onion Routing Spec</H1>
    <B>Joseph Poon</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20%5BBOLT%20Draft%5D%20Onion%20Routing%20Spec&In-Reply-To=%3C20160819183647.GB15105%40lightning.network%3E"
       TITLE="[Lightning-dev] [BOLT Draft] Onion Routing Spec">joseph at lightning.network
       </A><BR>
    <I>Fri Aug 19 18:36:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="000595.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
        <LI>Next message: <A HREF="000598.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#597">[ date ]</a>
              <a href="thread.html#597">[ thread ]</a>
              <a href="subject.html#597">[ subject ]</a>
              <a href="author.html#597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 19, 2016 at 10:26:31AM +0930, Rusty Russell wrote:
&gt;<i> &gt;&gt; &gt; While not dangerous it is rather unfortunate as it results in
</I>&gt;<i> &gt;&gt; &gt; guesswork. It is not dangerous because if A transferred litecoin to B
</I>&gt;<i> &gt;&gt; &gt; then B will (hopefully) never forward a higher value to C using
</I>&gt;<i> &gt;&gt; &gt; bitcoin, and if it were bitcoin then the final recipient would not
</I>&gt;<i> &gt;&gt; &gt; sign off an inferior amount than what he expected.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Worse case: C is a charity, accepting donations.  A's software screwed
</I>&gt;<i> &gt;&gt; up and didn't realize C was litecoin, not bitcoin.  B collects a huge
</I>&gt;<i> &gt;&gt; fee, C gets tiny donation.
</I>
Yeah, for sure, I agree with y'all. By default, there should be a
requirement that the amount is pre-negotiated by the sender and the
recipient (pay-to-contract, etc.)

Sufficient percentages of senders to a charity should be interested in
getting a receipt to prove funds were sent to a charity that I don't
think pre-sending it without generating a proof shouldn't be a normal
case. By default, I don't think clients should even send funds until
they have a signed receipt before cross-chain is supported for safety.

However, I'm not too concerned with cross-chain. As long as there's some
identifier between each hop, I suspect that should be sufficient. Is the
intent of the realm byte to indicate protocols? I think it's reasonable
to have some kind of byte for identifying the message (e.g. using this
as a transport layer for other things), but I think there should already
be sufficient information for cross-chain, presuming pay-to-contract.

&gt;<i> &gt; True, that's a dangerous scenario. If the recipient does not know the
</I>&gt;<i> &gt; intended amount and accepts anything then fee-shaving is very
</I>&gt;<i> &gt; profitable.
</I>&gt;<i> 
</I>&gt;<i> Which creates a subtle requirement: even the terminal onion should
</I>&gt;<i> include an amount.
</I>
This may not fully solve the problem, since if one presumes that the
second-to-last hop is malicious, they can re-create a new onion blob
(presuming consistent hashes for each hop, of course).

There may be a requirement from deriving the fee amount for the last
hop, though.

&gt;<i> &gt; In general I'm a bit concerned about rhash re-use, after
</I>&gt;<i> &gt; all today it's not uncommon to just publish a bitcoin address, people
</I>&gt;<i> &gt; might be tempted to do the same in Lightning.
</I>&gt;<i> 
</I>&gt;<i> Hmm, maybe we should implement the code to steal such re-sends?  Or more
</I>&gt;<i> generously, fail it.  That would prevent this from becoming a habit, at
</I>&gt;<i> least.
</I>
Either way seems practical for some nodes -- I presume if a small
percentage of nodes redeem without forwarding, then basically nobody
would re-use.  Not sure if &quot;steal&quot; is the right word, though.

-- 
Joseph Poon
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000595.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
	<LI>Next message: <A HREF="000598.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#597">[ date ]</a>
              <a href="thread.html#597">[ thread ]</a>
              <a href="subject.html#597">[ subject ]</a>
              <a href="author.html#597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
