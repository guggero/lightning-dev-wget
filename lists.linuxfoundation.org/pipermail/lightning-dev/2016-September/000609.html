<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] [BOLT Draft] Onion Routing Spec
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2016-September/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20%5BBOLT%20Draft%5D%20Onion%20Routing%20Spec&In-Reply-To=%3CCAO3Pvs_WugO6CRMxHPZJ7QtaiTTb%3D1EFpBrbzKk_BbP8%2B%3D-nKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000608.html">
   <LINK REL="Next"  HREF="000622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] [BOLT Draft] Onion Routing Spec</H1>
    <B>Olaoluwa Osuntokun</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20%5BBOLT%20Draft%5D%20Onion%20Routing%20Spec&In-Reply-To=%3CCAO3Pvs_WugO6CRMxHPZJ7QtaiTTb%3D1EFpBrbzKk_BbP8%2B%3D-nKA%40mail.gmail.com%3E"
       TITLE="[Lightning-dev] [BOLT Draft] Onion Routing Spec">laolu32 at gmail.com
       </A><BR>
    <I>Fri Sep  9 23:52:41 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="000608.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
        <LI>Next message: <A HREF="000622.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#609">[ date ]</a>
              <a href="thread.html#609">[ thread ]</a>
              <a href="subject.html#609">[ subject ]</a>
              <a href="author.html#609">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rusty Russell &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">rusty at rustcorp.com.au</A>&gt; wrote:

&gt;<i> Each node ID is 33 bytes (pubkey) each channel is 6 bytes (blocknum +
</I>txnum).

Using blocknum+txnum to identify a channel doesn't account for the
possibility of a single transaction which opens multiple channels
concurrently. A possible use-case for such a transaction are coin-joined
channel openings which obfuscate the relationships being creating with a
channel opening. You'd need to tack on an extra byte (maybe two) to also
encode the output index of the channel within the transaction. Additionally,
identifying channels based solely from blockheight+offsets conjures up some
re-org safety concerns. It's also a bit less &quot;verifiable&quot; than referring via
the full outpoint.

&gt;<i> The proofs are larger: to prove which IDs owns a channel, each one needs a
</I>&gt;<i> merkle proof (12 x 32 bytes) plus the funding tx (227 bytes, we can skip
</I>&gt;<i> some though), the two pubkeys (66 bytes), and a signature of the ID using
</I>&gt;<i> those pubkeys (128 bytes, schnorr would be 64?).
</I>
Are those two pub keys the multi-sig pub keys, or the identity pub keys? In
either case, only requiring two pub keys to attest-to/authenticate the state
of a channel is insufficient. With only two signatures, then nodes can
advertise the same channel several times creating a non-canonical graphs
resulting in differing network views. If we'd like to eliminate such a
possibility, then we also need to cryptographically bind the two identities
to the proof. Using a schnorr multi-signature generated by the four pubkeys
would remedy this. Validators can use pubkey recovery to extract the &quot;group
pubkey&quot; from the single signature, ensure it's the result of point addition
of the four public keys, check the channel isn't closed, then verify the
signature over the advertisement as normal.


Christian Decker &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">decker.christian at gmail.com</A>&gt; wrote:

&gt;<i> I forgot that we have two potential key-rotations:
</I>&gt;<i> - Rotating the key used in transactions that hit the Bitcoin network
</I>
If you mean the key included within the 2-of-2 multi-sig, I assume all
implementations will be using a fresh key with each channel either way, so
we don't need any explicit rotations here?

I've only been thinking of rotations for the onion pubkeys used for the DH
shared secret derivation for the onion packets. Identity keys could also
possibly either be rotated/revoked, or delegated with some sort of
&quot;certificate&quot;.

&gt;<i> Another case we could consider is having passive rotations: when an
</I>&gt;<i> endpoint announces a channel's existence it also sends its rotation
</I>&gt;<i> interval along.
</I>
IMO a passive rotation scheme is superior due to the bandwidth savings of
pushing the onion key rotations to the edges themselves. As you said an
active rotation might be used in the emergency case of a forced key rotation
due to key compromise.


Rusty Russell &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">rusty at rustcorp.com.au</A>&gt; wrote:

&gt;<i> Hmm, do we lose forward secrecy if we use a BIP32 chain?  But we may be
</I>&gt;<i> able to use another derivation method where we derive key N from key
</I>&gt;<i> N-1.  I'm looking at Laolu...
</I>
Well, sorta. If the master pubkey is published, and nodes use public
derivation on the edges to do passive key rotations, then if one of the
non-hardened child private keys is leaked, an adversary can derive the
master private key thereby gaining the ability to decrypt any
saved/intercepted onion packets to the compromised node.

Earlier in this email chain I suggested a scheme to regain forward secrecy
in the case of such a private key leak by requiring nodes to do some upfront
pre-computation involving an intermediate derivation point. This would still
allow passive rotation by the edges. However, in practice those
pre-generated would likely be stored in the same location? So that kinda
puts us back at the original exploit scenario.

If we were to involve some pairing crypto (IBE style), we would use say
block hashes to allow nodes to passively derive keys the &quot;source&quot; node is
able to generate the corresponding private key to...

IMO we need to more clearly state our security model/assumptions here to
reason about the attack scenarios we'll try to guard against.


-- Laolu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20160909/486374b1/attachment.html">http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20160909/486374b1/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000608.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
	<LI>Next message: <A HREF="000622.html">[Lightning-dev] [BOLT Draft] Onion Routing Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#609">[ date ]</a>
              <a href="thread.html#609">[ thread ]</a>
              <a href="subject.html#609">[ subject ]</a>
              <a href="author.html#609">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
