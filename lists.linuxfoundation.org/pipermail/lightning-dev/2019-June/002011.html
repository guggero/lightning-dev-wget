<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] ECDH for spontaneous payments and offline	vending machines
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-June/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20ECDH%20for%20spontaneous%20payments%20and%20offline%0A%09vending%20machines&In-Reply-To=%3CCACL8y1t32EAqkqL0247-KgneBE2ve%3DxhwdjpZ-KKOsDu8BAALQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002010.html">
   <LINK REL="Next"  HREF="002012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] ECDH for spontaneous payments and offline	vending machines</H1>
    <B>Stepan Snigirev</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20ECDH%20for%20spontaneous%20payments%20and%20offline%0A%09vending%20machines&In-Reply-To=%3CCACL8y1t32EAqkqL0247-KgneBE2ve%3DxhwdjpZ-KKOsDu8BAALQ%40mail.gmail.com%3E"
       TITLE="[Lightning-dev] ECDH for spontaneous payments and offline	vending machines">snigirev.stepan at gmail.com
       </A><BR>
    <I>Mon Jun 10 08:34:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="002010.html">[Lightning-dev] ECDH for spontaneous payments and offline	vending machines
</A></li>
        <LI>Next message: <A HREF="002012.html">[Lightning-dev] ECDH for spontaneous payments and offline	vending machines
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2011">[ date ]</a>
              <a href="thread.html#2011">[ thread ]</a>
              <a href="subject.html#2011">[ subject ]</a>
              <a href="author.html#2011">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi ZmnSCPxj,

&gt;<i> Just to be clear: each time the vending node needs a new invoice, it
</I>generates a new ephemeral key `k`?

Yes, the vending machine generates a new `k` for every invoice.

The same technique can be used for spontaneous payments as well and in this
case we can also provide additional information to the node about the
payment. For example, let's say I have my digitalocean account with some
user id. If I want to top-up my account with certain amount I could just
generate an invoice myself and pay it, and I could also include my ID (or
login) into the short channel id. The node would see this information and
top-up my account with the money I just sent.

Effectively this routing trick allows including a &quot;payment purpose&quot; by
misusing the short channel id. It is a workaround as it uses the data field
not according to the purpose and has a limit of 8 bytes, so I would prefer
to have some metadata field in the invoice that should be passed to the
payee in the onion packet instead, but this requires changes in the bolt 11
and as far as I understand something like that is already on the roadmap.

Stepan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20190610/6abf7165/attachment.html">http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20190610/6abf7165/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002010.html">[Lightning-dev] ECDH for spontaneous payments and offline	vending machines
</A></li>
	<LI>Next message: <A HREF="002012.html">[Lightning-dev] ECDH for spontaneous payments and offline	vending machines
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2011">[ date ]</a>
              <a href="thread.html#2011">[ thread ]</a>
              <a href="subject.html#2011">[ subject ]</a>
              <a href="author.html#2011">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
