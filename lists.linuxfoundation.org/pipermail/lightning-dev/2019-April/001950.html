<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Outsourcing route computation with trampoline	payments
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-April/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Outsourcing%20route%20computation%20with%20trampoline%0A%09payments&In-Reply-To=%3CiN3QSIGAh-ByhvpGdP7JaoPoZlNgSsG-Rt_3RXsq5stBxMX-iG0AqwK5hZhUmMGCYHt22aIzUzYpMJBFsPmP2KryYXn13-GCX-UDdl2cII4%3D%40protonmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001949.html">
   <LINK REL="Next"  HREF="001954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Outsourcing route computation with trampoline	payments</H1>
    <B>ZmnSCPxj</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Outsourcing%20route%20computation%20with%20trampoline%0A%09payments&In-Reply-To=%3CiN3QSIGAh-ByhvpGdP7JaoPoZlNgSsG-Rt_3RXsq5stBxMX-iG0AqwK5hZhUmMGCYHt22aIzUzYpMJBFsPmP2KryYXn13-GCX-UDdl2cII4%3D%40protonmail.com%3E"
       TITLE="[Lightning-dev] Outsourcing route computation with trampoline	payments">ZmnSCPxj at protonmail.com
       </A><BR>
    <I>Mon Apr  1 04:04:44 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="001949.html">[Lightning-dev] Routemap scaling (was: Just in Time Routing	(JIT-Routing) and a channel rebalancing heuristic as an add	on for improved routing success in BOLT 1.0)
</A></li>
        <LI>Next message: <A HREF="001954.html">[Lightning-dev] Outsourcing route computation with trampoline	payments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1950">[ date ]</a>
              <a href="thread.html#1950">[ thread ]</a>
              <a href="subject.html#1950">[ subject ]</a>
              <a href="author.html#1950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning Rene and Pierre,

An issue here (which I think also affects Rendezvous Routing) is with compatibility of the HMAC.

HMAC covers the entire 1300-byte `hops_data` field.

If, in order to reach the next trampoline, more than one intermediate node is inserted, would the packet that reaches the next trampoline have a valid HMAC still?
Consider that the filler data generated by the current trampoline to communicate with intermediate nodes may cause different filler data to be XORed with the 0x00 data added to left-shift the data at each intermediate node.
(I am unsure if I express myself coherently here)

So for example, suppose I am the source and I trampoline to nodes B and C, and pay to destination D.
Suppose B is a direct neighbor of mine, but I have no idea where C and D are.

Suppose for simplicity that the onion packet is just 6 hops long.
So I initialize as:

[ 00000 ] [ 00000 ] [ 00000 ] [ 00000 ] [ 00000 ] [ 00000 ]

I right shift and insert destination D:

[ D, here's my payment ] [ 00000 ] [ 00000 ] [ 00000 ] [ 00000 ] [ 00000 ]

Then I encrypt with some shared secret known by me A and D:

[ encrypt(A * D, &quot;D, here's my payment&quot;) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ]

Then I right shift and insert trampoline C:

[ C, send this to D ] [ encrypt(A * D, &quot;D, here's my payment&quot;) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ] [ encrypt(A * D, 0) ]

Then I encrypt with some shared secret known by me A and C:

[ encrypt(A * C, &quot;C, send this to D&quot;) ] [ encrypt(A * C, encrypt(A * D, &quot;D, here's my payment&quot;)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ]

Then I right shift and insert trampoline B:

[ B, send this to C ] [ encrypt(A * C, &quot;C, send this to D&quot;) ] [ encrypt(A * C, encrypt(A * D, &quot;D, here's my payment&quot;)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ]

And encrypt with A * B:

[ encrypt(A * B, &quot;B, send this to C&quot;) ] [ encrypt(A * B, encrypt(A * C, &quot;C, send this to D&quot;)) ] [ encrypt(A * B, encrypt(A * C, encrypt(A * D, &quot;D, here's my payment&quot;))) ] [ encrypt(A * B, encrypt(A * C, encrypt(A * D, 0))) ] [ encrypt(A * B, encrypt(A * C, encrypt(A * D, 0))) ] [ encrypt(A * B, encrypt(A * C, encrypt(A * D, 0))) ]

I send this to B, who removes one layer of encryption:

[ B, send this to C ] [ encrypt(A * C, &quot;C, send this to D&quot;) ] [ encrypt(A * C, encrypt(A * D, &quot;D, here's my payment&quot;)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ] [ encrypt(A * C, encrypt(A * D, 0)) ]

Now B finds the shortest route involves nodes N and O before reaching C.
So B has to insert N and O, pushing out one packet from the end.
But the pushed-out packet will no longer be recoverable and it cannot be re-encrypted except by A.

(Unless I misunderstand the onion construction)


Unless we propose to massively change the onion packet construction...?


&gt;<i> 1.) A different fee mechanism. Let us (only as a radical thought experiment) assume we drop the privacy of the final amount in routing.
</I>
Please no.

&gt;<i> A sending node could offer a fee for successful routing. Every routing node could decide how much fee it would collect for forwarding. Nodes could try to collect larger fees than the min they announce but that lowers the probably for the payment to be successful. Even more radical: Nodes would not even have to announce min fees anymore. Turning routing and fees to a real interactive market
</I>
Would this not also require that intermediate nodes know the ultimate destination of the payment?
How would intermediate nodes find out which next hop would be reasonable?

Regards,
ZmnSCPxj
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001949.html">[Lightning-dev] Routemap scaling (was: Just in Time Routing	(JIT-Routing) and a channel rebalancing heuristic as an add	on for improved routing success in BOLT 1.0)
</A></li>
	<LI>Next message: <A HREF="001954.html">[Lightning-dev] Outsourcing route computation with trampoline	payments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1950">[ date ]</a>
              <a href="thread.html#1950">[ thread ]</a>
              <a href="subject.html#1950">[ subject ]</a>
              <a href="author.html#1950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
