<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] An Argument For Single-Asset Lightning Network
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-December/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20An%20Argument%20For%20Single-Asset%20Lightning%20Network&In-Reply-To=%3C1545985631.10970.2.camel%40ultimatestunts.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001765.html">
   <LINK REL="Next"  HREF="001763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] An Argument For Single-Asset Lightning Network</H1>
    <B>CJP</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20An%20Argument%20For%20Single-Asset%20Lightning%20Network&In-Reply-To=%3C1545985631.10970.2.camel%40ultimatestunts.nl%3E"
       TITLE="[Lightning-dev] An Argument For Single-Asset Lightning Network">cjp at ultimatestunts.nl
       </A><BR>
    <I>Fri Dec 28 08:27:11 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="001765.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
        <LI>Next message: <A HREF="001763.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1762">[ date ]</a>
              <a href="thread.html#1762">[ thread ]</a>
              <a href="subject.html#1762">[ subject ]</a>
              <a href="author.html#1762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi ZmnSCPxj,

I think we've already addressed this issue before:
<A HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-May/0012">https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-May/0012</A>
92.html

and especially this proposal of me:
<A HREF="https://bitonic.nl/public/slowdown_prevention.pdf">https://bitonic.nl/public/slowdown_prevention.pdf</A>

It's not completely trustless, but I tend to see trustlessness in a
very pragmatic sense anyway. Trust creates a risk, but if the
alternative trustless system is very impractical, and the risk is small
enough, the benefits might simply be worth the risks. Note that this is
a completely subjective trade-off, so it is only acceptable on an
individual, voluntary basis.

CJP

ZmnSCPxj via Lightning-dev schreef op do 27-12-2018 om 05:43 [+0000]:
&gt;<i> HTLCs as American Call Option, or, How Lightning Currently Cannot
</I>&gt;<i> Work Across Assets, or, An Argument For Single-Asset Lightning
</I>&gt;<i> Network
</I>&gt;<i> 
</I>&gt;<i> Introduction
</I>&gt;<i> ============
</I>&gt;<i> 
</I>&gt;<i> In theory, the Lightning Network could potentially perform &quot;seamless&quot;
</I>&gt;<i> currency conversions, allowing a payer to spend one currency to pay a
</I>&gt;<i> payee requesting for another currency.
</I>&gt;<i> However, a significant technical barrier prevents implementation of
</I>&gt;<i> such feature as of current designs (late 2018) for Lightning.
</I>&gt;<i> 
</I>&gt;<i> The root cause of this significant technical barrier is the use of
</I>&gt;<i> hashlocked timelocked contracts to route payments.
</I>&gt;<i> HTLCs can be used across cryptocurrency systems to transfer value
</I>&gt;<i> between them.
</I>&gt;<i> From this point-of-view, every single Lightning Network channel is a
</I>&gt;<i> cryptocurrency system whose custodians are two entities, who are the
</I>&gt;<i> only entities who can use the system (the single Lightning Network
</I>&gt;<i> channel).
</I>&gt;<i> HTLCs allow cross-system trades to be performed, so that
</I>&gt;<i> participation on any single Lightning Network channel can be
</I>&gt;<i> leveraged to participation over the entire Lightning Network.
</I>&gt;<i> 
</I>&gt;<i> However, HTLCs can also be used to construct American Call Options.
</I>&gt;<i> Further, due to UX concerns, on the Lightning Network, there is no
</I>&gt;<i> cost incurred in merely setting up HTLCs for routing.
</I>&gt;<i> By using the low-level HTLCs provided as primitives by Lightning
</I>&gt;<i> Network, one can set up American Call Options.
</I>&gt;<i> These on-Lightning American Call Options, however, can be &quot;purchased&quot;
</I>&gt;<i> for free (gratis), thus potentially earning money in a completely
</I>&gt;<i> risk-free manner.
</I>&gt;<i> Abusing this gratis ability means that any Lightning Network node
</I>&gt;<i> advertising cross-asset on-Lightning exchange will find large amounts
</I>&gt;<i> of its liquidity tied up in stalled forwarding payments (in reality,
</I>&gt;<i> American Call Options) with a risk of monetary loss in case of large
</I>&gt;<i> fluctuations in exchange rate.
</I>&gt;<i> 
</I>&gt;<i> Hashlocked Timelocked Contracts as American Call Options
</I>&gt;<i> ========================================================
</I>&gt;<i> 
</I>&gt;<i> An American CallOption is a right (but not obligation) to purchase an
</I>&gt;<i> asset at a specific price, on or before an expiration date.
</I>&gt;<i> HTLCs allow building American Call Options.
</I>&gt;<i> 
</I>&gt;<i> Suppose we have Bitcoin, and some other asset, and both are on
</I>&gt;<i> blockchains that support the same hash function and can define HTLCs.
</I>&gt;<i> It is unimportant if both are on the same blockchain, or on different
</I>&gt;<i> blockchains, since HTLCs can work across cryptocurrency systems.
</I>&gt;<i> 
</I>&gt;<i> An American Call Option has these properties:
</I>&gt;<i> 
</I>&gt;<i> 1.&#160;&#160;`P` = the price at which the asset can be purchased.
</I>&gt;<i> 2.&#160;&#160;`E` = the date at which the option expires.
</I>&gt;<i> 
</I>&gt;<i> Suppose I, ZmnSCPxj, wanted to sell you an American Call Option&#160;&#160;for
</I>&gt;<i> 1 Widget (WJT) on the WJT blockchain.
</I>&gt;<i> We would then do the below ritual:
</I>&gt;<i> 
</I>&gt;<i> 1.&#160;&#160;You provide me a hash of some secret preimage that only you know.
</I>&gt;<i> 2.&#160;&#160;You make an HTLC on the Bitcoin blockchain.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value of this HTLC is `P`, the hash is the hash you gave
</I>&gt;<i> above, and the timelock is `E` + 1 day.
</I>&gt;<i> 3.&#160;&#160;I make an HTLC on the WJT blockchain.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value of this HTLC is 1, the hash is the hash you gave, and
</I>&gt;<i> the timelock is `E`.
</I>&gt;<i> 
</I>&gt;<i> On or before `E`, you can claim the WJT on the WJT blockchain by
</I>&gt;<i> providing a transaction that reveals the preimage.
</I>&gt;<i> Since the preimage is now revealed, I can then claim the Bitcoins of
</I>&gt;<i> price `P` on the Bitcoin blockchain.
</I>&gt;<i> Alternately, you can simply not exercise this right, and at time `E`
</I>&gt;<i> I would then reclaim my WJT, and at time `E` + 1 day you would
</I>&gt;<i> reclaim your bitcoins.
</I>&gt;<i> 
</I>&gt;<i> Of course, I want to *sell* this contract to you, so you would have
</I>&gt;<i> to pay me some bitcoins before we set up the above.
</I>&gt;<i> A multi-stage construction of transactions that go through HTLC-like
</I>&gt;<i> constructs can be done on both blockchains to ensure that the above
</I>&gt;<i> contracts appear on both chains only if the payment for the actual
</I>&gt;<i> contract (i.e. the &quot;premium&quot;) is done, and to enforce that both
</I>&gt;<i> contracts appear if the premium is paid, but that is beyond the scope
</I>&gt;<i> of *this* writeup, which will focus on how Lightning Network HTLCs
</I>&gt;<i> can form the above construction without any premium being paid.
</I>&gt;<i> 
</I>&gt;<i> HTLCs For Routing
</I>&gt;<i> =================
</I>&gt;<i> 
</I>&gt;<i> HTLCs can be used to enforce trades across different cryptocurrency
</I>&gt;<i> systems.
</I>&gt;<i> This property is used to allow routing of payments across different
</I>&gt;<i> channels.
</I>&gt;<i> Each channel is its own cryptocurrency system.
</I>&gt;<i> 
</I>&gt;<i> Suppose I, ZmnSCPxj, am an intermediate node on Lightning, and I
</I>&gt;<i> wanted to sell you my service of facilitating payments on Lightning.
</I>&gt;<i> Suppose you want to pay to somebody, who, for the sake of
</I>&gt;<i> convenience, we shall randomly call YAIjbOJA.
</I>&gt;<i> As it happens, I have a channel with you, and a channel with
</I>&gt;<i> YAIjbOJa.
</I>&gt;<i> 
</I>&gt;<i> You need to pay YAIjbOJA `P` bitcoins.
</I>&gt;<i> We then perform the below ritual:
</I>&gt;<i> 
</I>&gt;<i> 1.&#160;&#160;YAIjbOJA provides you a hash, whose preimage only YAIjbOJA knows.
</I>&gt;<i> 2.&#160;&#160;On your channel with me, you set up an HTLC.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value is `P`+1 bitcoin (the 1 being my fee), the hash is the
</I>&gt;<i> hash you were given, and the timelock is 2 days from now.
</I>&gt;<i> 3.&#160;&#160;On my channel with YAIjbOJA, I set up an HTLC.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value is `P`, the hash is the same hash as above, and the
</I>&gt;<i> timelock is 1 day from now.
</I>&gt;<i> 
</I>&gt;<i> (in reality, the timelocks are parameterized and selected by the
</I>&gt;<i> payer (you), and LN nodes will impose some &quot;reasonable&quot; limits on the
</I>&gt;<i> timelocks; but the first HTLCs set up must have longer timelocks than
</I>&gt;<i> the later HTLCs)
</I>&gt;<i> 
</I>&gt;<i> Afterward, YAIjbOJA may claim, or may not claim, the money in the
</I>&gt;<i> HTLC by releasing (or not releasing) the hash to me.
</I>&gt;<i> If YAIjbOJA claims the money, then I can take the hash and claim the
</I>&gt;<i> money, plus fee, from you.
</I>&gt;<i> If not, then this is a payment failure and I will then cancel the
</I>&gt;<i> HTLC you offered using standard Lightning Network primitives.
</I>&gt;<i> 
</I>&gt;<i> In general, we expect that YAIjbOJA wants to have the money because
</I>&gt;<i> every randomly-generated imaginary entity likes money.
</I>&gt;<i> Thus, in the case of payments, YAIjbOJA has a strong incentive to
</I>&gt;<i> claim the money without waiting for the timelock to expire or nearly
</I>&gt;<i> expire.
</I>&gt;<i> We can see that in practice, on the current Lightning Network, HTLCs
</I>&gt;<i> are often very transient and will be quickly claimed, despite having
</I>&gt;<i> long timelocks.
</I>&gt;<i> 
</I>&gt;<i> This speed may mislead us into thinking that such convenience may be
</I>&gt;<i> possible across different assets.
</I>&gt;<i> 
</I>&gt;<i> Cross-Asset Lightning Nodes Offer Premium-Free American Call Options
</I>&gt;<i> ====================================================================
</I>&gt;<i> 
</I>&gt;<i> Suppose that Lightning Network supports multiple assets.
</I>&gt;<i> Each channel has a single asset.
</I>&gt;<i> Some nodes will advertise themselves as providing exchange
</I>&gt;<i> capability, taking one asset on one channel and exchanging it for
</I>&gt;<i> another asset on a different channel.
</I>&gt;<i> 
</I>&gt;<i> Suppose I advertise myself as such an exchange.
</I>&gt;<i> Suppose you want to pay to YAIjbOJA for 1 WJT, but have no WJT on
</I>&gt;<i> hand to pay YAIjbOJA, only bitcoins.
</I>&gt;<i> As it happens, I have a bitcoin channel with you and a WJT channel
</I>&gt;<i> with YAIjbOJA.
</I>&gt;<i> I advertise myself as exchanging `P` bitcoins for 1 WJT as of the
</I>&gt;<i> current time.
</I>&gt;<i> 
</I>&gt;<i> Further suppose that in reality, YAIjbOJA is *you*, random Internet
</I>&gt;<i> person reading my thoughts.
</I>&gt;<i> 
</I>&gt;<i> You, your fake persona YAIjbOJA, and me, then perform the following
</I>&gt;<i> ritual:
</I>&gt;<i> 
</I>&gt;<i> 1.&#160;&#160;YAIjbOJA (really you) provides you with a hash whose preimage
</I>&gt;<i> only YAIjbOJA (actually you) know. (i.e. you just make it up)
</I>&gt;<i> 2.&#160;&#160;On the bitcoin channel with me, you set up an HTLC.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value is `P`+1 bitcoin (the 1 being my fee), the hash is the
</I>&gt;<i> hash that &quot;YAIjbOJA&quot; gave you (i.e. you really just made it up), and
</I>&gt;<i> the timelock is 2 days from now.
</I>&gt;<i> 3.&#160;&#160;On the WJT channel with YAIjbOJA (really you), I set up an HTLC.
</I>&gt;<i> &#160;&#160;&#160;&#160;The value is 1 WJT, the hash is the hash you gave me, and the
</I>&gt;<i> timelock is 1 day from now.
</I>&gt;<i> 
</I>&gt;<i> The above is now the same as the setup for an American Call Option
</I>&gt;<i> with expiration of 1 day from now.
</I>&gt;<i> Further, within certain limits, you can set up the expiration of the
</I>&gt;<i> American Call Option to be longer or shorter.
</I>&gt;<i> Thus, I have inadvertently given you an American Call Option, for *no
</I>&gt;<i> premium* (completely gratis), when my only intent was to facilitate
</I>&gt;<i> cross-currency Lightning Network payments.
</I>&gt;<i> 
</I>&gt;<i> Suppose that the price of 1 WJT rises far above the price of `P`+1
</I>&gt;<i> bitcoins before the expiration (1 day from now).
</I>&gt;<i> In such a case, &quot;YAIjbOJA&quot; (really you) will then release the hash
</I>&gt;<i> and acquire the 1 WJT.
</I>&gt;<i> You then close this channel and claim the WJT onchain, then sell it
</I>&gt;<i> immediately to earn more than the `P`+1 bitcoins you paid.
</I>&gt;<i> Alternatively, presumably I would have a new exchange rate I would be
</I>&gt;<i> willing to exchange WJT for, and you can just send the WJT with the
</I>&gt;<i> new exchange rate immediately over the Lightning Network.
</I>&gt;<i> 
</I>&gt;<i> Suppose that the price of WJT does not rise.
</I>&gt;<i> Since this is an option and *not* a future, &quot;YAIjbOJA&quot; (really you)
</I>&gt;<i> will simply claim that the payment errored somewhere and cancel the
</I>&gt;<i> HTLCs.
</I>&gt;<i> Since even payment errors are not unwrappable and are onion-wrapped,
</I>&gt;<i> I cannot determine whether the payment really errored, or you were
</I>&gt;<i> just setting up an American Call Option that you have now decided not
</I>&gt;<i> to exercise.
</I>&gt;<i> 
</I>&gt;<i> Premium-free American Call Options Are Risk-free Earning Pumps
</I>&gt;<i> ==============================================================
</I>&gt;<i> 
</I>&gt;<i> Traditionally, options are analyzed assuming that the option itself
</I>&gt;<i> has a price, the premium.
</I>&gt;<i> This premium is the risk of the user of the option.
</I>&gt;<i> If the user of the option does not exercise the option before the
</I>&gt;<i> expiration, then the premium is a pure loss of the user.
</I>&gt;<i> 
</I>&gt;<i> However, the above setup does not involve any payment when the option
</I>&gt;<i> is not exercised.
</I>&gt;<i> Payment failures are &quot;free&quot; (gratis) on the Lightning Network.
</I>&gt;<i> However, payment failures are also the non-exercised branch of the
</I>&gt;<i> American Call Option that can be set up on a cross-currency on-
</I>&gt;<i> Lightning exchange.
</I>&gt;<i> 
</I>&gt;<i> Because the American Call Option is premium-free, even if the
</I>&gt;<i> expiration is very near, rational entities will still construct such
</I>&gt;<i> options.
</I>&gt;<i> Extreme volatility may occur in short time frames, especially in the
</I>&gt;<i> realm of digital assets.
</I>&gt;<i> 
</I>&gt;<i> Thus, it is strongly likely that, if cross-asset exchange nodes on
</I>&gt;<i> Lightning Network exist, they will be exploited to create risk-free
</I>&gt;<i> American Call Options.
</I>&gt;<i> They will find that significant liquidity will be tied up in such
</I>&gt;<i> American Call Options, and find that they will lose funds especially
</I>&gt;<i> at times of volatility.
</I>&gt;<i> 
</I>&gt;<i> We can try to mitigate this, but the solutions below all have
</I>&gt;<i> significant drawbacks.
</I>&gt;<i> 
</I>&gt;<i> 1.&#160;&#160;We could force that setting up the HTLCs requires payment.
</I>&gt;<i> &#160;&#160;&#160;&#160;This forces the above American Call Options to have a premium.
</I>&gt;<i> &#160;&#160;&#160;&#160;The effect, however, is that routing failure is not free.
</I>&gt;<i> &#160;&#160;&#160;&#160;The current Lightning Network works despite not everyone
</I>&gt;<i> publishing the balances of channels, precisely because routing
</I>&gt;<i> failure is free.
</I>&gt;<i> &#160;&#160;&#160;&#160;We only need to have one route succeed in order to actually
</I>&gt;<i> successfully pay to the payee.
</I>&gt;<i> &#160;&#160;&#160;&#160;With non-free routing failure, we cannot try many routes until
</I>&gt;<i> one succeeds.
</I>&gt;<i> &#160;&#160;&#160;&#160;* Suppose we limited this only to cross-asset exchanges.
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;It would still require accurate knowledge of channel balances.
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;This is because if a payment fails on a hop *after* the
</I>&gt;<i> exchange, the payer still loses money from that attempt to the
</I>&gt;<i> exchange node.
</I>&gt;<i> 2.&#160;&#160;Exchange nodes could increase their fees.
</I>&gt;<i> &#160;&#160;&#160;&#160;This would create a wider &quot;spread&quot; of buying and selling assets.
</I>&gt;<i> &#160;&#160;&#160;&#160;This spread would increase friction in crossing assets.
</I>&gt;<i> &#160;&#160;&#160;&#160;Also, this would only reduce risk; if the exchange rate is
</I>&gt;<i> volatile enough, then the option could still be exercised for
</I>&gt;<i> riskless earnings.
</I>&gt;<i> &#160;&#160;&#160;&#160;Rational entities will still tie up most of the liquidity on the
</I>&gt;<i> exchange on riskless American Call Options; even if the exchange rate
</I>&gt;<i> is very stable, they lose nothing.
</I>&gt;<i> 3.&#160;&#160;Exchange nodes could limit the timelock of cross-asset swaps.
</I>&gt;<i> &#160;&#160;&#160;&#160;This would increase friction in crossing assets, since a timelock
</I>&gt;<i> limit also imposes a limit to the route length.
</I>&gt;<i> &#160;&#160;&#160;&#160;If one asset is much stronger than the other, then the weaker
</I>&gt;<i> asset will find its part of the Lightning Network to be strongly
</I>&gt;<i> centralized around the exchanges between the two assets.
</I>&gt;<i> &#160;&#160;&#160;&#160;Payees of the weaker asset will strongly prefer to be at most one
</I>&gt;<i> hop away from exchanges in order to viably receive payments from
</I>&gt;<i> payers who are using the stronger asset.
</I>&gt;<i> &#160;&#160;&#160;&#160;Again, rational entities will also still tie up most of the
</I>&gt;<i> liquidity on the exchange on riskless American Call Options; again,
</I>&gt;<i> even if the exchange rate is very stable in short time frames, they
</I>&gt;<i> lose nothing anyway.
</I>&gt;<i> 
</I>&gt;<i> Conclusion
</I>&gt;<i> ==========
</I>&gt;<i> 
</I>&gt;<i> HTLCs allow creation of American Call Options.
</I>&gt;<i> The same HTLCs are used in Lightning Network to route across
</I>&gt;<i> channels.
</I>&gt;<i> If using a single asset, there is no issue related to time.
</I>&gt;<i> Regardless of the value of bitcoin relative to any other asset, in
</I>&gt;<i> the future, 1 BTC is 1 BTC.
</I>&gt;<i> 
</I>&gt;<i> However, across assets, the ability of HTLCs to create American Call
</I>&gt;<i> Options becomes troublesome.
</I>&gt;<i> These can then be exploited to earn money from exercise of the
</I>&gt;<i> option.
</I>&gt;<i> Further, because Lightning UX would be degraded otherwise, payment
</I>&gt;<i> failures are free (gratis), leading to the American Call Options also
</I>&gt;<i> being free of premium.
</I>&gt;<i> This means that creating such options would be riskless, allowing
</I>&gt;<i> potential earnings upon any strong volatility of exchange rates.
</I>&gt;<i> 
</I>&gt;<i> This implies that a multi-asset Lightning Network may not be
</I>&gt;<i> economically viable.
</I>&gt;<i> Instead, Lightning Network would strongly prefer having a single
</I>&gt;<i> asset across the network.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Lightning-dev mailing list
</I>&gt;<i> <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">Lightning-dev at lists.linuxfoundation.org</A>
</I>&gt;<i> <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev</A>
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001765.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
	<LI>Next message: <A HREF="001763.html">[Lightning-dev] An Argument For Single-Asset Lightning Network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1762">[ date ]</a>
              <a href="thread.html#1762">[ thread ]</a>
              <a href="subject.html#1762">[ subject ]</a>
              <a href="author.html#1762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
