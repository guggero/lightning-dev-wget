<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lightning-dev] Escrow Over Lightning?
   </TITLE>
   <LINK REL="Index" HREF="https://lists.linuxfoundation.org/pipermail/lightning-dev/2021-February/index.html" >
   <LINK REL="made" HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Escrow%20Over%20Lightning%3F&In-Reply-To=%3CCALGTLwMUTXp0%2BFXyhyhVCmt0NXudw4x_2sUq0f-4MvYXxetPEQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002949.html">
   <LINK REL="Next"  HREF="002953.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lightning-dev] Escrow Over Lightning?</H1>
    <B>Nadav Kohen</B> 
    <A HREF="mailto:lightning-dev%40lists.linuxfoundation.org?Subject=Re:%20Re%3A%20%5BLightning-dev%5D%20Escrow%20Over%20Lightning%3F&In-Reply-To=%3CCALGTLwMUTXp0%2BFXyhyhVCmt0NXudw4x_2sUq0f-4MvYXxetPEQ%40mail.gmail.com%3E"
       TITLE="[Lightning-dev] Escrow Over Lightning?">nadav at suredbits.com
       </A><BR>
    <I>Mon Feb  8 19:49:30 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="002949.html">[Lightning-dev] Escrow Over Lightning?
</A></li>
        <LI>Next message: <A HREF="002953.html">[Lightning-dev] Escrow Over Lightning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2952">[ date ]</a>
              <a href="thread.html#2952">[ thread ]</a>
              <a href="subject.html#2952">[ subject ]</a>
              <a href="author.html#2952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andr&#233;s,

&gt;<i> Am I correct in understanding that this is a proposal to change the spec
</I>(maybe add a new BOLT) so that all lightning implementations can try to
support this feature.

Yes, the proposal relies on the use of PTLCs in place of HTLCs which is a
popular change that will (hopefully) be brought about by Taproot. It is
worth noting that this change is not specific to this protocol and that
only the end nodes (buyer and seller) would need any special code in order
to execute these contracts if the underlying Lightning Network was using
PTLCs.

&gt;<i> If the above is true, then I'm wondering: could a Lightning-based escrow
</I>system be implemented that doesn't require to modify the existing
implementations? Maybe if we simplify the requirements a bit? Like,
removing the &quot;Escrow only learns of dispute cases, never learns non-dispute
case&quot; aspect? That is, the third-party S always knows about an escrow
between A and B taking place.

At a high level, what is required here is that the payment goes through iff
[Seller AND (Buyer OR Escrow)] agree to it. Lifting restrictions so that
the Escrow is allowed to be more interactive can allow the Buyer and Escrow
to do an interactive shared secret generation and this secret could then be
used in a spontaneous payment to the Seller (meaning the payment hash is
generated by the Buyer and not the Seller) and then the Seller would have
to obtain a ZKP from the Escrow that the payment hash is the hash of a
secret known to the Escrow. If all of this were done, then the Seller could
execute given the shared secret from either the Buyer or the Escrow. Of
note, another downside to this scheme beyond Escrow involvement is that
there is no proof of payment/reciept over the Lightning Network for this
payment because it is a spontaneous payment.

Like ZmnSCPxj's proposal, this would only require special code for the &quot;end
nodes&quot; (Buyer and Seller) and the underlying HTLC-based lightning network
would require no changes. Also note that this scheme relies on the
existence of a Zero Knowledge Proof of Knowledge (ZKPoK) of a hash which is
not a trivial piece of work but certainly do-able.

Hi Pedro,

I actually did have a question for you about Virtual Channels: The first
time I read the paper it struck me that while on the surface things look
pretty nice for the virtual channel participants, the intermediary has to
lock up a lot of collateral (in total, the size of the channel) in order to
enable this and subsequently this channel could stay open for a very long
time. As such, to the intermediary this seems very similar to having to
route a (potentially very large) hodl HTLC which means they will be
charging a very large fee for both the setup and the duration of the
channel. Because of this, I'm having trouble thinking of almost any use
cases where this is preferable to just routing payments the normal way
other than if the in-between node is not reliable and there are no other
cheap routes (in which case it might be worth it to pay a premium). Did you
or your colleagues have other use cases in mind? And have you done any fee
analysis for this scheme?

Best,
Nadav

On Mon, Feb 8, 2021 at 2:43 AM Pedro Moreno-Sanchez &lt;
<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">pedrorechezmailinglists at gmail.com</A>&gt; wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> While reading this thread I realized that my colleagues and I have been
</I>&gt;<i> working on a construction called &#8220;Bitcoin-compatible Virtual Channels&#8221; [1]
</I>&gt;<i> that, at a first glance, highly resembles the use case and requirements
</I>&gt;<i> that you put forward in this thread. In a nutshell, a Virtual Channel is
</I>&gt;<i> built on top of two payment channels and use them to construct its own
</I>&gt;<i> &#8220;funding transaction&#8221;. Imagine that Buyer and Seller do not have a payment
</I>&gt;<i> channel between them, but they both have a payment channel with a  common
</I>&gt;<i> node (e.g., Escrow in your example). Alice and Bob can create a Virtual
</I>&gt;<i> Channel between them using fundings from both: channel Alice-Escrow and
</I>&gt;<i> channel Escrow-Bob. After created, the Virtual Channel offers the same
</I>&gt;<i> functionality as a direct payment channel between Alice and Bob (i.e.,
</I>&gt;<i> Escrow is no longer involved for payments). Our construction makes sure
</I>&gt;<i> that no party losses funds when the Virtual Channel needs to be closed
</I>&gt;<i> (either when Alice and Bob collaborate or any of the 3 parties cheat).
</I>&gt;<i>
</I>&gt;<i> This construction is compatible with the current Bitcoin script (e.g.,
</I>&gt;<i> taproot is not required although perhaps useful when available) and with
</I>&gt;<i> the Lightning Network. In the paper, we describe our construction assuming
</I>&gt;<i> that a payment-channel follows the design in &#8220;Generalized
</I>&gt;<i> Bitcoin-Compatible Channels&#8221; [2], however the Virtual Channel construction
</I>&gt;<i> can seamlessly work using the current Lightning payment channels.
</I>&gt;<i>
</I>&gt;<i> I would be glad to hear any feedback that you may have.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Pedro Moreno-Sanchez
</I>&gt;<i>
</I>&gt;<i> ==
</I>&gt;<i>
</I>&gt;<i> [1] <A HREF="https://eprint.iacr.org/2020/554">https://eprint.iacr.org/2020/554</A>
</I>&gt;<i> [2] <A HREF="https://eprint.iacr.org/2020/476.pdf">https://eprint.iacr.org/2020/476.pdf</A>
</I>&gt;<i>
</I>&gt;<i> &gt; On Feb 8, 2021, at 9:09 AM, Andr&#233;s G. Aragoneses &lt;<A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">knocte at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hey ZmnSCPxj,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Am I correct in understanding that this is a proposal to change the spec
</I>&gt;<i> (maybe add a new BOLT) so that all lightning implementations can try to
</I>&gt;<i> support this feature.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If the above is true, then I'm wondering: could a Lightning-based escrow
</I>&gt;<i> system be implemented that doesn't require to modify the existing
</I>&gt;<i> implementations? Maybe if we simplify the requirements a bit? Like,
</I>&gt;<i> removing the &quot;Escrow only learns of dispute cases, never learns non-dispute
</I>&gt;<i> case&quot; aspect? That is, the third-party S always knows about an escrow
</I>&gt;<i> between A and B taking place.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I understand that the above requirement is a good to have, but if
</I>&gt;<i> removing it allows a simpler version of escrow be implemented, then at
</I>&gt;<i> least there could be an interim solution for non-custodial exchanges to
</I>&gt;<i> start adopting this (otherwise they have to resort to custodial-based
</I>&gt;<i> escrows, which is worse than lacking the escrow privacy brought by the
</I>&gt;<i> requirement above).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Lightning-dev mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">Lightning-dev at lists.linuxfoundation.org</A>
</I>&gt;<i> &gt; <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Lightning-dev mailing list
</I>&gt;<i> <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">Lightning-dev at lists.linuxfoundation.org</A>
</I>&gt;<i> <A HREF="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20210208/89782223/attachment.html">http://lists.linuxfoundation.org/pipermail/lightning-dev/attachments/20210208/89782223/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002949.html">[Lightning-dev] Escrow Over Lightning?
</A></li>
	<LI>Next message: <A HREF="002953.html">[Lightning-dev] Escrow Over Lightning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2952">[ date ]</a>
              <a href="thread.html#2952">[ thread ]</a>
              <a href="subject.html#2952">[ subject ]</a>
              <a href="author.html#2952">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.linuxfoundation.org/mailman/listinfo/lightning-dev">More information about the Lightning-dev
mailing list</a><br>
</body></html>
